import os
import sys
import json
import datetime

mod = "{}/source/python".format(os.environ["KEICA_TOOL_PATH"])
if mod not in sys.path:
    sys.path.append(mod)

import KcLibs.core.kc_env as kc_env

app = os.environ.get("__PUZZLE_APP__", "")

if "mayapy" in app:
    import maya.standalone 
    maya.standalone.initialize(name="python")
    __STANDALONE__ = True
else:
    __STANDALONE__ = False

sys.path.append(os.environ["__PUZZLE_PATH__"])
from puzzle.Puzzle import Puzzle

x = Puzzle(file_mode=True)
#results = x.play_as_file_mode()

if "__PUZZLE_RESULT__" in os.environ:
    json.dump({"data": {
                        "result": x.messages
                        }, 
               "info": {
                        "datetime": datetime.datetime.now().strftime("%Y/%m/%d %H:%M:%S")}
                        }, open(os.environ["__PUZZLE_RESULT__"], "w"), "utf8", indent=4)


if __STANDALONE__:
    try:
        maya.standalone.uninitialize()
        os._exit(0)
    except:
        pass

if "3dsmax" in app:
    import MaxPlus
    MaxPlus.Core.EvalMAXScript("quitMax #noPrompt")

print "END"
