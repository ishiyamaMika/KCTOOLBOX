#-*- coding: utf8 -*-

import copy
from . import PzLog

class Piece(object):
    def __init__(self, **args):
        #self.data = args["data"]
        self.data = copy.deepcopy(args.get("data"), {})
        self.pass_data = args.get("pass_data", {})
        self.piece_data = args.get("piece_data", {})
        self.logger = args.get("logger", False)
        
        if "paint" in self.piece_data:
            for k, v in self.piece_data["paint"].items():
                if v in self.data:
                    self.data[k] = self.data[v]
                    del self.data[v]
                elif v.startswith("@"):
                    if v in self.pass_data:
                        self.data[k] = self.pass_data[v]

        self.header = ""
        self.detail = ""
        self.filtered = True
        if "filters" in self.piece_data:
            for filter_ in self.piece_data["filters"]:
                for k, v in filter_.items():
                    if not k in self.data:
                        self.filtered = False
                        break
                    if isinstance(v, list):
                        if not self.data[k] in v:
                            self.filtered = False
                    else:
                        if v != self.data[k]:
                            self.filtered = False

    def execute(self, **args):
        return True, self.pass_data, self.header, self.detail
